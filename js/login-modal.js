customElements.get("login-modal")||customElements.define("login-modal",class extends ModalDialog{constructor(){super()}hide(){super.hide(),$("html").removeClass("overflow-hidden")}show(opener){super.show(opener),$("html").addClass("overflow-hidden"),this.toggleCustomer();const self=this,signInButton=document.getElementById("signInButton"),recoverButton=document.getElementById("recoverButton"),registerButton=document.getElementById("registerButton");signInButton.addEventListener("click",function(){const emailField=document.getElementById("CustomerEmail"),paswordField=document.getElementById("CustomerPassword");self.validateLoginForm(emailField,paswordField)}),recoverButton.addEventListener("click",function(){const emailField=document.getElementById("RecoverEmail");self.validateRecoverForm(emailField)}),document.getElementById("is_subscribed").addEventListener("change",function(){const customerTags=document.getElementById("customer_tags"),tag="newsletter";this.checked?(customerTags.value.includes(tag)||(customerTags.value+=(customerTags.value?",":"")+tag),customerTags.setAttribute("name","customer[tags]")):(customerTags.value=customerTags.value.split(",").filter(item=>item!==tag).join(","),customerTags.value||customerTags.removeAttribute("name"))}),registerButton.addEventListener("click",function(){const emailField=document.getElementById("RegisterForm-email"),firstNameField=document.getElementById("RegisterForm-FirstName"),lastNameField=document.getElementById("RegisterForm-LastName"),passwordField=document.getElementById("RegisterForm-password"),confirmField=document.getElementById("RegisterForm-confirm-password"),tcAgreeCheckbox=document.getElementById("tc-agree-create-account");self.validateRegisterForm(emailField,passwordField,firstNameField,lastNameField,confirmField,tcAgreeCheckbox)})}toggleCustomer(){var customers=document.querySelectorAll(".customer");customers.forEach(function(customer){customer.classList.add("hidden")});var loginCustomer=document.querySelector(".customer.login");typeof loginCustomer<"u"&&loginCustomer!=null&&loginCustomer.classList.remove("hidden");var customerLinks=document.querySelectorAll(".customer-link");customerLinks.forEach(function(link){link.addEventListener("click",function(){var href=link.dataset.href;customers.forEach(function(customer){customer.classList.add("hidden")});var customerToShow=document.querySelector(".customer."+href);customerToShow&&customerToShow.classList.remove("hidden")})})}validateLoginForm(emailField,paswordField){let isValid=!0;emailField.value.trim()===""?(isValid=!1,emailField.classList.add("error"),this.displayErrorMessage(emailField,!0,"It is a required field.")):this.isValidEmail(emailField.value.trim())?(emailField.classList.remove("error"),this.displayErrorMessage(emailField,!1)):(isValid=!1,emailField.classList.add("error"),this.displayErrorMessage(emailField,!0,"Please enter a valid email address.")),paswordField.value.trim()===""?(isValid=!1,paswordField.classList.add("error"),this.displayErrorMessage(paswordField,!0,"It is a required field.")):(paswordField.classList.remove("error"),this.displayErrorMessage(paswordField,!1)),isValid&&this.submitLogin()}validateRecoverForm(emailField){let isValid=!0;emailField.value.trim()===""?(isValid=!1,emailField.classList.add("error"),this.displayErrorMessage(emailField,!0,"It is a required field.")):this.isValidEmail(emailField.value.trim())?(emailField.classList.remove("error"),this.displayErrorMessage(emailField,!1)):(isValid=!1,emailField.classList.add("error"),this.displayErrorMessage(emailField,!0,"Please enter a valid email address.")),isValid&&this.submitRecover(emailField.value.trim())}validateRegisterForm(emailField,passwordField,firstNameField,lastNameField,confirmField,tcAgreeCheckbox){let isValid=!0;var captchaContainer=document.getElementById("re-captcha-modal"),captchaError=document.getElementById("captcha-error");captchaError||(captchaError=document.createElement("div"),captchaError.id="captcha-error",captchaError.style.color="#fc7077",captchaError.style.fontSize="12px",captchaContainer.parentNode.insertBefore(captchaError,captchaContainer.nextSibling)),firstNameField.value.trim()===""?(isValid=!1,firstNameField.classList.add("error"),this.displayErrorMessage(firstNameField,!0,"It is a required field.")):(firstNameField.classList.remove("error"),this.displayErrorMessage(firstNameField,!1)),lastNameField.value.trim()===""?(isValid=!1,lastNameField.classList.add("error"),this.displayErrorMessage(lastNameField,!0,"It is a required field.")):(lastNameField.classList.remove("error"),this.displayErrorMessage(lastNameField,!1)),emailField.value.trim()===""?(isValid=!1,emailField.classList.add("error"),this.displayErrorMessage(emailField,!0,"It is a required field.")):this.isValidEmail(emailField.value.trim())?(emailField.classList.remove("error"),this.displayErrorMessage(emailField,!1)):(isValid=!1,emailField.classList.add("error"),this.displayErrorMessage(emailField,!0,"Please enter a valid email address.")),passwordField.value.trim()===""?(isValid=!1,passwordField.classList.add("error"),this.displayErrorMessage(passwordField,!0,"It is a required field.")):this.checkPasswordStrength(passwordField)?(passwordField.classList.remove("error"),this.displayErrorMessage(passwordField,!1)):(isValid=!1,passwordField.classList.add("error"),this.displayErrorMessage(passwordField,!0,"Minimum length of this field must be equal or greater than 8 symbols. Leading and trailing spaces will be ignored.")),confirmField.value.trim()===""?(isValid=!1,confirmField.classList.add("error"),this.displayErrorMessage(confirmField,!0,"It is a required field.")):this.validatePasswordConfirmation(passwordField,confirmField)?(confirmField.classList.remove("error"),this.displayErrorMessage(confirmField,!1)):(isValid=!1,confirmField.classList.add("error"),this.displayErrorMessage(confirmField,!0,"Please enter the same value again.")),tcAgreeCheckbox.checked?(tcAgreeCheckbox.classList.remove("error"),this.displayErrorMessage(tcAgreeCheckbox,!1)):(isValid=!1,tcAgreeCheckbox.classList.add("error"),this.displayErrorMessage(tcAgreeCheckbox,!0,"It is a required field."));var isCaptchaValid=grecaptcha.getResponse()!=="";isCaptchaValid?captchaError.textContent="":(isValid=!1,captchaError.textContent="It Is A Required Field."),isValid&&this.submitRegister()}displayErrorMessage(field,display,message=""){const errorMessage=field.parentElement.querySelector(".error-message");errorMessage&&(errorMessage.innerHTML=message,errorMessage.style.display=display?"block":"none")}isValidEmail(email){var emailPattern=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return emailPattern.test(email)}validatePasswordConfirmation(passwordInput,confirmPasswordInput){var password=passwordInput.value,confirmPassword=confirmPasswordInput.value;return password===confirmPassword}checkPasswordStrength(passwordInput){var password=passwordInput.value;return password.length>=8}submitLogin(){const loginForm=document.getElementById("customer_login"),signInButton=document.getElementById("signInButton"),createButton=document.getElementById("registerBtn"),msgEle=document.querySelector(".customer.login > .message"),email=document.querySelector("#CustomerEmail").value,formData=new FormData(loginForm),formAction=loginForm.getAttribute("action"),formMethod=loginForm.getAttribute("method");fetch(window.subscriptionEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"check-email",email})}).then(response=>{if(!response.ok)throw new Error("Network response was not ok "+response.statusText);return response.json()}).then(data=>{const messageElement=document.createElement("div");messageElement.id="api-response-message";const errorMessageElement=document.getElementById("error_account-active"),errorMessageTitle=document.getElementById("message-error-title"),existingMessageElement=document.getElementById("api-response-message");if(existingMessageElement&&existingMessageElement.remove(),data.has_account){const tags=data.customer.tags;data.account_activate?fetch(formAction,{method:formMethod,body:formData,headers:{Accept:"application/json"}}).then(response=>{response.url.indexOf("/login")===-1?(typeof msgEle<"u"&&msgEle!=null&&(msgEle.classList="message success",msgEle.innerHTML="<div>Login successful.</div>"),setTimeout(function(){window.location.reload()},500)):typeof msgEle<"u"&&msgEle!=null&&(msgEle.classList="message error",msgEle.innerHTML="<div>Invalid login or password.</div>")}).catch(error=>{console.error("Login Error:",error),typeof msgEle<"u"&&msgEle!=null&&(msgEle.classList="message error",msgEle.innerHTML="<div>Invalid login or password.</div>")}):tags?.includes("newsletter")?(document.querySelectorAll(".form__message.error-message-container").forEach(element=>{element.classList.add("active")}),errorMessageTitle.classList.remove("active"),messageElement.innerText="Email does not have an account. Please register.",errorMessageElement.appendChild(messageElement)):(messageElement.innerHTML=window.loginFormStrings.reset_password_message,errorMessageTitle.classList.add("active"),errorMessageTitle.innerHTML=data.message_title,errorMessageElement.appendChild(messageElement),document.querySelectorAll(".form__message.error-message-container").forEach(element=>{element.classList.add("active")}),document.getElementById("error_account-active").classList.add("activate-message"),document.getElementById("send-activation-email").addEventListener("click",function(event){(!event.detail||event.detail===1)&&(event.preventDefault(),fetch(window.subscriptionEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"send-activation-email",email})}).then(response=>{if(!response.ok)throw new Error("Network response was not ok "+response.statusText);return response.json()}).then(data2=>{console.log(data2.message),alert(window.loginFormStrings.activation_sent)}).catch(error=>console.error("Error:",error)))}))}else console.log("dont have account"),document.querySelectorAll(".form__message.error-message-container").forEach(element=>{element.classList.add("active")}),errorMessageTitle.classList.remove("active"),messageElement.innerText=data.message,errorMessageElement.appendChild(messageElement),errorMessageElement.classList.remove("activate-message")}).catch(error=>console.error("Error:",error))}submitRecover(email){const recoverForm=document.querySelector(".customer.recover form"),recoverBtn=document.getElementById("recoverButton"),msgEle=document.querySelector(".customer.recover > .message"),formData=new FormData(recoverForm),formAction=recoverForm.getAttribute("action"),formMethod=recoverForm.getAttribute("method");recoverBtn.disabled=!0,fetch(formAction,{method:formMethod,body:formData,headers:{Accept:"application/json"}}).then(response=>{if(typeof msgEle<"u"&&msgEle!=null){msgEle.classList="message success";const msg=window.loginFormStrings.recover_password_message_success;msgEle.innerHTML=msg.replace("[email]",email)}recoverBtn.disabled=!1}).catch(error=>{console.error("Login Error:",error),typeof msgEle<"u"&&msgEle!=null&&(msgEle.classList="message error",msgEle.innerHTML="<div>something went wrong, try again.</div>"),recoverBtn.disabled=!1})}submitRegister(){var regiterForm=document.getElementById("create_customer"),createButton=document.getElementById("registerButton");const msgEle=document.querySelector(".customer.register > .message");var formData=new FormData(regiterForm),formAction=regiterForm.getAttribute("action"),formMethod=regiterForm.getAttribute("method");fetch(formAction,{method:formMethod,body:formData,headers:{Accept:"application/json"}}).then(response=>{if(response.url.indexOf("/register")===-1)console.log("creates successfully",{msgEle}),Shopify?.analytics?.publish?.("fbq_complete_registration"),typeof msgEle<"u"&&msgEle!=null&&(msgEle.classList="message success",msgEle.innerHTML="<div>Create an account successfully. Please wait...</div>"),setTimeout(function(){window.location.reload()},500);else{if(response.url.includes("/register"))return response.text().then(bodyText=>{const formMessageElements=new DOMParser().parseFromString(bodyText,"text/html").querySelectorAll(".form__message ul li");if(formMessageElements.length>0){const existingErrorMessage=document.getElementById("formMessageError");typeof msgEle<"u"&&msgEle!=null&&(msgEle.classList="message error",msgEle.innerHTML="<div>"+formMessageElements[0].innerHTML+"</div>")}else console.log("No form__message elements found.")});console.log("User created fail"),typeof msgEle<"u"&&msgEle!=null&&(msgEle.classList="message error",msgEle.innerHTML="<div>There is already an account with this email address. If you are sure that it is your email address, &lt;a href=&quot;/account/login#recover&quot; class=&quot;txt-und&quot;&gt;click here&lt;/a&gt; to get your password and access your account.</div>")}}).catch(error=>{console.error("Created Error:",error),typeof msgEle<"u"&&msgEle!=null&&(msgEle.classList="message error",msgEle.innerHTML="<div>There is already an account with this email address. If you are sure that it is your email address, &lt;a href=&quot;/account/login#recover&quot; class=&quot;txt-und&quot;&gt;click here&lt;/a&gt; to get your password and access your account.</div>")})}});
//# sourceMappingURL=/cdn/shop/t/8/assets/login-modal.js.map?v=23766222082737078671730423527
